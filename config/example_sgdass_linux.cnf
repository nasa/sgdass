# sgdass_config  Version 1.4   of 2021.12.13
#
# Space Geodesy Data Analysis Software Suite configuration file under Linux
# 
# Last update: 2024.11.15_18:07:00
#
[Directories]
  dir:  /apr         # for apriori data. ~100 Gb
  dir:  /auto        # for automatization programs 1-10 Mb
  dir:  /cont        # for control files  10-100 Mb
  dir:  /dist        # for third-party package distributions 1-50 Gb
  dir:  /images      # for source images 150 Gb
  dir:  /image_orig  # for original source images 300 Gb
  dir:  /incoming    # for tar-balls 1-2 Gb
  dir:  /l0          # for Level 0  VLBI data. 5-500 Tb
  dir:  /l1a/        # for Level 1A VLBI data. 1-20 Tb
  dir:  /l1b/        # for Level 1b VLBI data. 1-20 Tb
  dir:  /l2          # for Level 2  VLBI data. 50-100 Gb. Should be on a fast nvme
  dir:  /l3          # for Level 3  VLBI data. 1-10 Gb
  dir:  /logs        # for logs
  dir:  /opt64       # installation directory /opt64/lib should be in the LD_LIBRARY_PATH or in /etc/ld.so.conf
  dir:  /progs       # for in-house software packages 1-10 Gb
  dir:  /scr         # for scratch files 10-3000 Gb. Should be on a fast nvme
  dir:  /sde         # for single dish experiments
  dir:  /sol         # for solutions
  dir:  /vlbi        # for VLBI experiments
  dir:  /imls        # for IMLS data

[SubDirectories]:
  subdir: /apr/eop       # apriori Earth orientation paramers
  subdir: /apr/eph       # apriori ephemerides
  subdir: /apr/iono      # apriori ionosphere data
  subdir: /apr/load_bds  # apriori mass loading time series in bindisp format
  subdir: /apr/load_hps  # apriori mass loading harmonic variations
  subdir: /apr/psolve    # apriori files for psolve
  subdir: /apr/sou       # apriori source positions
  subdir: /apr/spd       # apriori station path delays
  subdir: /apr/sta       # apriori station positions
  subdir: /apr/temp      # apriori temporary files
  subdir: /l2/gvf        # Level 2 VLBI data in GVF format
  subdir: /l2/vda        # Level 2 VLBI data in vgosda format
  subdir: /l2/vdb        # Level 2 VLBI data in vgosdb format
  subdir: /logs/sgdass              # logs from sgdass installation
  subdir: /scr/pima                 # PIMA related files created during processing experiments.
  subdir: /scr/psolve               # temporary files created by psolve
  subdir: /scr/psolve/cgm_dir       # auxiliary combined glboal matrices created by psolve
  subdir: /scr/psolve/tpd           # auxiliary files with path delay created by psolve
  subdir: /scr/psolve/spool_dir     # listing of solutions generated by psolve
  subdir: /scr/psolve/sub_matrices  # auxiliary temporary files created by psolve
  subdir: /scr/psolve/work_dir      # auxiliary files by psolve
  subdir: /sol/heo                  # High frequency Earth Orientation parameter VLBI solutions
  subdir: /sol/qua                  # Quarterly VLBI solutions
  subdir: /sol/rewei                # Reweighting VLBI solutions
  subdir: /sol/rfc                  # astrometric VLBI solutions
  subdir: /vlbi/vtd_data            # data files for VTD
  subdir: /imls/oper_model          # IMLS operational models
  subdir: /imls/devel_model         # IMLS development models

[Compilers]
  gcc           /opt64/bin/gcc
  gcx           /opt64/bin/g++
  gfortran      /opt64/bin/gfortran
  cla           none
  clap          none
  cmake         /opt64/bin/cmake

[Where]
  tarball       /progs/sgdass       # directory with unpacked sgdass tarballs
  build         /progs              # build directory the primary packages
  build_aux     /dist               # build directory for axilliary third party packages
  prefix        /opt64              # installation directory
  sdk           none

[Misc]
  num_proc      all
  center_abr    UC
  center_name  "Unknwon Center" 
  install_log   /logs/sgdass/sgdass_@DATE@_install.log
  build_log     /logs/sgdass/sgdass_@DATE@_build.log

#
# End of user customizations
#
# --- Initial test
#
[Tests]
  package: petools      
  version: 20241115
           options:     --prefix=${prefix}                       \
                        --bits=64                                \
                        --short-test                             \
                        CC=${gcc}                                \
                        FC=${gfortran}
           build:       make short-test

#
# --- Third party packages
#
[AuxPackages]

  package: patch
  version: 2.7.6
           options:     --prefix=${prefix}         \
                        CC=${gcc}
           build:       make -j ${num_proc}
           build:       make install

#
  package: pkg-config
  version: 0.29.2
           options:     --prefix=${prefix}         \
                        --with-internal-glib       \
                        --libdir=${prefix}/lib     \
                        --disable-host-tool        \
                        CC=${gcc}                  \
                        CXX=${gcc}
           build:       make -j ${num_proc}
           build:       make install

#
  package: lzlib
  version: 1.13
           options:     --prefix=${prefix}     \
                        --enable-shared        \
                        --libdir=${prefix}/lib \
                        --disable-ldconfig     \
                        CC=${gcc}
           build:       make -j ${num_proc}
           build:       make install

#
  package: zlib
  version: 1.3.1
           options:     --prefix=${prefix}      \
                        --libdir=${prefix}/lib     
           post_config: sed -i -e "s@CC=gcc@CC=${gcc}@g" Makefile
           post_config: sed -i -e 's@cp $(SHAREDLIBV) $(DESTDIR)$(sharedlibdir);@cp $(SHAREDLIBV) $(DESTDIR)$(sharedlibdir)/$(SHAREDLIBV)__ ; mv $(DESTDIR)$(sharedlibdir)/$(SHAREDLIBV)__ $(DESTDIR)$(sharedlibdir)/$(SHAREDLIBV) ;@g' Makefile
           post_config: sed -i -e 's@CFLAGS=-O3 @CFLAGS=-O3 -fPIC @g' Makefile
           post_config: sed -i -e 's@CFLAGS=-O @CFLAGS=-O3 -fPIC @g'  Makefile
           post_config: sed -i -e 's@SFLAGS=-O3 @SFLAGS=-O3 -fPIC @g' Makefile
           post_config: sed -i -e 's@SFLAGS=-O @SFLAGS=-O3 -fPIC @g'  Makefile
           build:       make -j ${num_proc}
           build:       make install

#
  package: bzip2
  version: 1.0.8
           build:       sed -i -e "s@CC=gcc@CC=${gcc}@g"                    Makefile
           build:       sed -i -e "s@-Wall -Winline@-Wall -fPIC -Winline@g" Makefile
           build:       sed -i -e "s@PREFIX=/usr/local@PREFIX=${prefix}@g"  Makefile
           build:       sed -i -e "s@PREFIX=/usr@PREFIX=${prefix}@g"        Makefile
           build:       sed -i -e 's@chmod a+x@\# chmod a+x@g'              Makefile
           build:       sed -i -e 's@chmod a+r@\# chmod a+r@g'              Makefile
           build:       make clean
           build:       make -j ${num_proc}
           build:       make install

#
  package: lbzip2
  version: 2.5
           patch:       lbzip2-01.patch
           options:     --prefix=${prefix}           \
                        CC=${gcc}                    \
                        CFLAGS="-I${prefix}/include" \
                        LDFLAGS="-L${prefix}/lib"    \
           build:       make clean
           build:       make -j ${num_proc}
           build:       make install

#
  package: xz
  version: 5.2.5
           options:     --prefix=${prefix}           \
                        --libdir=${prefix}/lib       \
                        CC=${gcc}                    \
                        CFLAGS="-I${prefix}/include" \
                        LDFLAGS="-L${prefix}/lib"
           build:       make -j ${num_proc}
           build:       make install
           build:       sed -i -e "s@/lib64@/lib@g" ${prefix}/lib/liblzma.la

#
  package: ncurses
  version: 6.4
           options:     --prefix=${prefix}     \
                        --libdir=${prefix}/lib \
                        --with-shared          \
                        --without-debug        \
                        --without-ada          \
                        --enable-overwrite     \
                        CC=${gcc}              \
                        CXX=${gcx}
           build:       make -j ${num_proc}
           build:       make install

#
  package: readline
  version: 8.2
           options:     --prefix=${prefix}            \
                        --libdir=${prefix}/lib        \
                        --with-curses                 \
                        --disable-shared              \
                        CCFLAGS="-I${prefix}/include" \
                        CFLAGS="-m64 -fPIC"           \
                        LDFLAGS="-L${prefix}/lib"     \
                        CC=${gcc}
           build:       make -j ${num_proc}
           build:       make install

#
  package: autoconf
  version: 2.71
           options:     --prefix=${prefix} \
                        CC=${gcc}
           build:       make -j ${num_proc}
           build:       make install

#
  package: automake
  version: 1.16.5
           options:     --prefix=${prefix}            \
                        CC=${gcc}                     \
                        CXX=${gcx}                    \
                        FC=${gfortran}
           post_config: sed -i -e 's@doc/aclocal-$(APIVERSION).1: $(aclocal_script) lib/Automake/Config.pm@\#doc/aclocal-$(APIVERSION).1: $(aclocal_script) lib/Automake/Config.pm@g'     Makefile
           post_config: sed -i -e 's@	$(update_mans) aclocal-$(APIVERSION)@\#	$(update_mans) aclocal-$(APIVERSION)@g'                                                                   Makefile
           post_config: sed -i -e 's@doc/automake-$(APIVERSION).1: $(automake_script) lib/Automake/Config.pm@\#doc/automake-$(APIVERSION).1: $(automake_script) lib/Automake/Config.pm@g' Makefile
           post_config: sed -i -e 's@	$(update_mans) automake-$(APIVERSION)@\#	$(update_mans) automake-$(APIVERSION)@g'                                                          Makefile
           post_config: sed -i -e 's%	@list1=%\#	@list1=%g' Makefile
           build:       make -j ${num_proc}
           build:       make install

#
  package: libtool
  version: 2.4.7
           pre_config:  chmod u+rw build-aux/ltmain.sh
           pre_config:  sed -i -e 's@$SED -e "$basename" | sort -u@$SED -e "$sed_basename" | sort -u@g' build-aux/ltmain.sh
           pre_config:  /usr/bin/touch doc/libtool.1
           options:     --prefix=${prefix}            \
                        --libdir=${prefix}/lib        \
                        --disable-dependency-tracking \
                        --program-prefix=g            \
                        --disable-ltdl-install        \
                        CC=${gcc}                     \
                        CXX=${gcx}                    \
                        FC=${gfortran}
           build:       make -j ${num_proc}
           build:       make install

#
  package: openssl
  version: 1.1.1u
           options:     --prefix=${prefix}     \
                        --libdir=${prefix}/lib \
                        shared                 \
                        zlib-dynamic           \
                        CC=${gcc}          
           post_config: sed -i -e "s@LIBDIR=lib64@LIBDIR=lib@g" Makefile
           post_config: if ( -l ${prefix}/ssl ) rm ${prefix}/ssl
           build:       make -j ${num_proc}
           build:       sed -i -e '/INSTALL_LIBS/s/libcrypto.a libssl.a//' Makefile
           build:       make install
           build:       if ( -d ${prefix}/ssl_orig ) rm -fR ${prefix}/ssl_orig 
           build:       mv      ${prefix}/ssl               ${prefix}/ssl_orig
           build:       ln -s /etc/ssl ${prefix}

#
  package: openldap
  version: 2.6.1
           patch:        openldap-01.patch
           pre_config:   autoconf
           options:      --prefix=${prefix}     \
                         --libdir=${prefix}/lib \
                         --enable-dynamic       \
                         --disable-debug        \
                         --disable-slapd        \
                        CC=${gcc}               \
                        CFLAGS="-fpermissive -I${prefix}/include" \
                        LDFLAGS=-L${prefix}/lib
           build:       make depend
           build:       make -j ${num_proc}
           build:       make install

#
  package: curl
  version: 8.7.1
           options:     --prefix=${prefix}        \
                        --libdir=${prefix}/lib    \
                        --with-openssl=${prefix}  \
			--without-nghttp2         \
                        CC=${gcc}                 \
                        LDFLAGS=-L${prefix}/lib 
           build:       make clean
           build:       make -j ${num_proc}
           build:       make install

#
  package: wget
  version: 1.25.0
           options:     --prefix=${prefix}           \
                        --libdir=${prefix}/lib       \
                        --with-linux-crypto          \
                        --with-ssl=openssl           \
                        --without-libgnutls-prefix   \
                        CC=${gcc}                    \
                        CFLAGS="-I${prefix}/include" \
                        LDFLAGS=-L${prefix}/lib 
           build:       make clean
           build:       make -j ${num_proc}
           build:       make install

#
  package: parallel
  version: 20230622
           options:     --prefix=${prefix}            \
                        --libdir=${prefix}/lib64      \
                        CC=${gcc}                     \
                        CCFLAGS="-I${prefix}/include" \
                        LDFLAGS="-L${prefix}/lib"     
           build:       make -j ${num_proc}
           build:       make install

#
  package: nasm
  version: 2.16.01
           options:     --prefix=${prefix}            \
                        --libdir=${prefix}/lib        \
                        CC=${gcc}                     \
                        CCFLAGS="-I${prefix}/include" \
                        LDFLAGS="-L${prefix}/lib"     
           build:       make -j ${num_proc}
           build:       make install

#
  package: libjpeg-turbo
  version: 3.0.1
           build:       if ( -d build_aux ) rm -fR build_aux 
           build:       mkdir build_aux
	   build:       cd build_aux
           build:       rm ${prefix}/lib/libjpeg*                  >& /dev/null
           build:       rm ${prefix}/lib/libturbo*                 >& /dev/null
           build:       rm ${prefix}/bin/wrjpgcom                  >& /dev/null
           build:       rm ${prefix}/bin/tjbench                   >& /dev/null
           build:       rm ${prefix}/bin/rdjpgcom                  >& /dev/null
           build:       rm ${prefix}/bin/jpegtran                  >& /dev/null
           build:       rm ${prefix}/bin/djpeg                     >& /dev/null
           build:       rm ${prefix}/bin/cjpeg                     >& /dev/null
           build:       rm ${prefix}/include/turbojpeg.h           >& /dev/null
           build:       rm ${prefix}/include/jpeglib.h             >& /dev/null
           build:       rm ${prefix}/include/jmorecfg.h            >& /dev/null
           build:       rm ${prefix}/include/jerror.h              >& /dev/null
           build:       rm ${prefix}/include/jconfig.h             >& /dev/null
           build:       rm ${prefix}/share/man/man1/wrjpgcom.1     >& /dev/null
           build:       rm ${prefix}/share/man/man1/rdjpgcom.1     >& /dev/null
           build:       rm ${prefix}/share/man/man1/jpegtran.1     >& /dev/null
           build:       rm ${prefix}/share/man/man1/djpeg.1        >& /dev/null
           build:       rm ${prefix}/share/man/man1/cjpeg.1        >& /dev/null
           build:       rm -fR ${prefix}/share/doc/libjpeg-turbo   >& /dev/null
           build:       rm ${prefix}/lib/pkgconfig/libjpeg.pc      >& /dev/null
           build:       rm ${prefix}/lib/pkgconfig/libturbojpeg.pc >& /dev/null
           build:       cmake -DCMAKE_INSTALL_PREFIX=${prefix} \
                              -DCMAKE_BUILD_TYPE=RELEASE    \
                              -DENABLE_STATIC=TRUE \
                              -DCMAKE_INSTALL_DEFAULT_LIBDIR=lib  \
                              -DCMAKE_C_COMPILER=${gcc} \
                              -DCMAKE_ASM_NASM_COMPILER=${prefix}/bin/nasm \
                              ..
           build:       make -j ${num_proc}
           build:       make install

#
  package: libpng
  version: 1.6.37
           patch:       libpng-01.patch
           pre_config:  make distclean >& /dev/null ; set status = 0
           options:     --prefix=${prefix}            \
                        --libdir=${prefix}/lib        \
                        --with-zlib-prefix=${prefix}  \
                        --disable-static              \
                        CC=${gcc}                     \
                        CXX=${gcx}                    \
                        LDFLAGS=-L${prefix}/lib 
           build:       make -j ${num_proc}
           build:       make install

#
  package: libtirpc
  version: 1.3.2
           options:     --prefix=${prefix}     \
                        --libdir=${prefix}/lib \
                        --disable-gssapi       \
                        CC=${gcc}              \
                        CXX=${gcx}             \
                        CFLAGS="-fpermissive"
           post_config: sed -i -e "s@/lib64@/lib@g" libtirpc.pc 
           build:       clean
           build:       make -j ${num_proc} V=1
           build:       make install
           build:       sed -i -e "s@/lib64@/lib@g" ${prefix}/lib/libtirpc.la 

#
  package: bison
  version: 3.8.2
           options:     --prefix=${prefix}     \
                        --libdir=${prefix}/lib \
                        CC=${gcc}
           build:       make -j ${num_proc}
           build:       make install

#
  package: flex
  version: 2.6.4
           options:     --prefix=${prefix}     \
                        --libdir=${prefix}/lib \
                        --enable-shared=no     \
                        --disable-shared       \
                        CC=${gcc}
           build:       make -j ${num_proc}
           build:       make install
           build:       rm ${prefix}/lib/libfl.s*
           build:       if ( -f ${prefix}/lib/libfl.la ) rm ${prefix}/lib/libfl.la

#
  package: hdf5
  version: 1.12.2
           pre_unpack:  if ( -f fortran/src/h5global.mod ) rm -fR fortran/src/
           pre_config:  if ( `cat ${prefix}/bin/petools_vars | grep MK5_F95_NOOPT | grep fallow-argument-mismatch` != "" ) setenv FF_EXTRA_OPT "-fallow-argument-mismatch"
           pre_config:  if ( `cat ${prefix}/bin/petools_vars | grep MK5_F95_NOOPT | grep fallow-argument-mismatch` == "" ) setenv FF_EXTRA_OPT ""
           options:     --prefix=${prefix}     \
                        --libdir=${prefix}/lib \
                        --enable-fortran       \
                        --enable-cxx           \
                        CC=${gcc}              \
                        CXX=${gcx}             \
                        FC=${gfortran}         \
                        FCFLAGS="-fbounds-check -fno-underscoring ${FF_EXTRA_OPT} -fPIC" \
                        CFLAGS="-m64"          \
                        CXXFLAGS="-m64"        \
                        LIBS="-lgfortran" 
           build:       make clean
           build:       make -j ${num_proc}
           build:       make install

#
  package: hdf
  version: 4.2.16
           pre_config:   find ./ -name "*.c" -exec sed -i -e "s/NC_findattr/SD_NC_findattr/g"   {} \;
           pre_config:   find ./ -name "*.h" -exec sed -i -e "s/NC_findattr/SD_NC_findattr/g"   {} \;
           pre_config:   find ./ -name "*.c" -exec sed -i -e "s/NC_check_id/SD_NC_check_id/g"   {} \;
           pre_config:   find ./ -name "*.h" -exec sed -i -e "s/NC_check_id/SD_NC_check_id/g"   {} \;
           pre_config:   find ./ -name "*.c" -exec sed -i -e "s/NC_var_shape/SD_NC_var_shape/g" {} \;
           pre_config:   find ./ -name "*.h" -exec sed -i -e "s/NC_var_shape/SD_NC_var_shape/g" {} \;
           pre_config:   find ./ -name "*.c" -exec sed -i -e "s/nctypelen/sd_nctypelen/g"       {} \;
           pre_config:   find ./ -name "*.h" -exec sed -i -e "s/nctypelen/sd_nctypelen/g"       {} \;
           pre_config:   find ./ -name "*.c" -exec sed -i -e "s/SD_SD_NC/SD_NC/g"               {} \;
           pre_config:   find ./ -name "*.c" -exec sed -i -e "s/sd_sd_nc/SD_nc/g"               {} \;
           pre_config:   if ( `cat ${prefix}/bin/petools_vars | grep MK5_F95_NOOPT | grep fallow-argument-mismatch` != "" ) setenv FF_EXTRA_OPT "-fallow-argument-mismatch"
           pre_config:   if ( `cat ${prefix}/bin/petools_vars | grep MK5_F95_NOOPT | grep fallow-argument-mismatch` == "" ) setenv FF_EXTRA_OPT ""
           options:      --prefix=${prefix}                 \
                         --libdir=${prefix}/lib             \
                         --includedir=${prefix}/include/hdf \
                         --disable-netcdf                   \
                         --enable-fortran                   \
                         --with-jpeg=${prefix}              \
                         CC=${gcc}                          \
                         F77=${gfortran}                    \
                         FFLAGS="-fbounds-check -fno-underscoring ${FF_EXTRA_OPT} -fPIC -L${prefix}/lib -lz -ltirpc" \
                         CFLAGS="-m64 -fpermissive -fPIC -I${prefix}/include/tirpc -L${prefix}/lib -ltirpc"
           post_config:  find ./ -name "Makefile"  -exec sed -i -e "s/ncgen dumper/dumper/g"    {} \;
           post_config:  find ./ -name "Makefile"  -exec sed -i -e "s/-ljpeg -lz /-ljpeg -lz -lm/g"  {} \;
           build:       make clean
           build:       make -j ${num_proc}
           build:       make install
           build:       ${gcc} -shared -Wl,--whole-archive -o ${prefix}/lib/libdf.so    ${prefix}/lib/libdf.a    -Wl,-no-whole-archive
           build:       ${gcc} -shared -Wl,--whole-archive -o ${prefix}/lib/libmfhdf.so ${prefix}/lib/libmfhdf.a -Wl,-no-whole-archive

#
  package: netcdf-c
  version: 4.9.2
           pre_config:   if ( `cat ${prefix}/bin/petools_vars | grep MK5_F95_NOOPT | grep fallow-argument-mismatch` != "" ) setenv FF_EXTRA_OPT "-fallow-argument-mismatch"
           pre_config:   if ( `cat ${prefix}/bin/petools_vars | grep MK5_F95_NOOPT | grep fallow-argument-mismatch` == "" ) setenv FF_EXTRA_OPT ""
           options:      --prefix=${prefix}     \
                         --libdir=${prefix}/lib \
                         --enable-shared        \
                         --enable-netcdf-4      \
                         --enable-hdf4          \
                         --disable-dap          \
                         --disable-pnetcdf      \
                         --disable-libxml2      \
                         CPPFLAGS="-I${prefix}/include -I${prefix}/include/hdf -I${prefix}/include/tirpc" \
                         LDFLAGS="-L${prefix}/lib" \
                         LIBS="-lhdf5 -lmfhdf -ldf -ljpeg -ltirpc -lgfortran" \
                         CC=${gcc}       \
                         F77=${gfortran} \
                         FFLAGS="-fbounds-check ${FF_EXTRA_OPT} -fno-underscoring -fPIC -DNoUnderscoreAppend -L${prefix}/lib -lz -ltirpc" \
                         CFLAGS="-m64 -fpermissive -fPIC -I${prefix}/include -I${prefix}/include/tirpc -L${prefix}/lib -lz -ltirpc"
           build:       make clean
           build:       make -j 1 
           build:       make check
           build:       make install

#
  package: netcdf-fortran
  version: 4.6.1
           pre_unpack:   cd ${build_aux}; cd netcdf-c-`${prefix}/bin/nc-config --version | awk '{print $2}'`
           pre_unpack:   setenv ROOT_netcdf_fortran `pwd`
           post_unpack:  setenv ROOT_netcdf_fortran ${package}-${vers}
           pre_config:   if ( `cat ${prefix}/bin/petools_vars | grep MK5_F95_NOOPT | grep fallow-argument-mismatch` != "" ) setenv FF_EXTRA_OPT "-fallow-argument-mismatch"
           pre_config:   if ( `cat ${prefix}/bin/petools_vars | grep MK5_F95_NOOPT | grep fallow-argument-mismatch` == "" ) setenv FF_EXTRA_OPT ""
           pre_config:   if ( -f ${prefix}/include/netcdf4_f03.mod ) rm ${prefix}/include/netcdf4_f03.mod
           options:      --prefix=${prefix}     \
                         --libdir=${prefix}/lib \
                  	 --enable-shared        \
                         FC=${gfortran}         \
                         F90=${gfortran}        \
                         CC=${gcc}              \
                  	 CPPFLAGS="-DNDEBUG -DpgiFortran -DNoUnderscoreAppend -I${prefix}/include" \
                  	 FFLAGS="-m64 -O3 -fPIC -fno-underscoring   ${FF_EXTRA_OPT}" \
                  	 F90FLAGS="-m64 -O3 -fPIC -fno-underscoring ${FF_EXTRA_OPT}" \
                         FCFLAGS="-m64 -O3 -fPIC -fno-underscoring  ${FF_EXTRA_OPT}" \
                         LDFLAGS="-L${prefix}/lib" \
                         LIBS="-L${prefix}/lib64 -lgfortran"
           build:        make clean
           build:        find fortran/ -name "*.la" -exec sed -i "s@/../lib/libgfortran.la@/../lib64/libgfortran.la@g" {} \;
           build:        find nf_test/ -name "*.la" -exec sed -i "s@/../lib/libgfortran.la@/../lib64/libgfortran.la@g" {} \;
           build:        make -j 1
           build:        make install

#
  package: w3lib
  version: 2.0.6
           patch:        w3lib-01.patch
           patch:        w3lib-02.patch
           build:        sed -i -e "s@F77     = gfortran@F77     = ${gfortran}@g" Makefile
           build:        sed -i -e "s@CC      = cc@CC     = ${gcc}@g" Makefile
           build:        if ( -f Makefile ) make clean
           build:        make -j ${num_proc}
           build:        ${gfortran} --shared -Wl,--whole-archive,-soname,libw3.so.1 -o ${prefix}/lib/libw3.so.1 libw3.a -Wl,-no-whole-archive
           build:        ln -sf ${prefix}/lib/libw3.so.1 ${prefix}/lib/libw3.so

#
  package: fftw         
  version: 3.3.10     
           pre_config:  make distclean >& /dev/null ; set status = 0
           options:     --prefix=${prefix}     \
                        --libdir=${prefix}/lib \
                        --enable-openmp        \
                        --enable-shared        \
                        --enable-sse2          \
                        --enable-avx2          \
                        --enable-fma           \
                        CC=${gcc}              \
                        F77=${gfortran}        \
                        CFLAGS="-m64 -Ofast -fomit-frame-pointer -malign-double -fstrict-aliasing -fno-stack-protector -march=native" \
                        FFLAGS="-m64 -fno-underscoring -Ofast -fomit-frame-pointer -malign-double -fstrict-aliasing -fno-stack-protector -march=native" \
           build:       make -j ${num_proc}
           build:       make install
           build:       make check >& double_check.log

#
  package: fftw          
  version: 3.3.10     
           pre_config:  make distclean >& /dev/null ; set status = 0
           options:     --prefix=${prefix}     \
                        --libdir=${prefix}/lib \
                        --enable-single        \
                        --enable-openmp        \
                        --enable-shared        \
                        --enable-sse           \
                        --enable-avx2          \
                        --enable-avx-128-fma   \
                        CC=${gcc}              \
                        F77=${gfortran}        \
                        CFLAGS="-m64 -Ofast -fomit-frame-pointer -malign-double -fstrict-aliasing -fno-stack-protector -march=native"
                        FFLAGS="-m64 -fno-underscoring -Ofast -fomit-frame-pointer -malign-double -fstrict-aliasing -fno-stack-protector -march=native"
            build:      make -j ${num_proc}
            build:      make install
            build:      make check >& single_check.log

#
  package: openblas      
  version: 0.3.28
           pre_unpack:   if ( -d ${build_aux}/openblas-${vers} ) rm -fR ${build_aux}/openblas-${vers}
           post_unpack:  mv OpenBLAS-${vers}  openblas-${vers}
           post_unpack:  setenv ROOT_openblas openblas-${vers}
           patch:        openblas-01.patch 
           options:      noconfigure
           build:        sed -i -e "s@_(@(@g" ctest/*.c
           build:        make NOUNDERSCORE=1                                            \
                         CC=${gcc}                                                      \
                         FC=${gfortran}                                                 \
                         COMMON_OPT="-D NOCHANGE -U NEEDBUNDERSCORE -D NOCHANGE -mavx2" \
                         FCOMMON_OPT="-fno-underscoring -fPIC"                          \
                         FFLAGS="-fopenmp -fno-underscoring -fPIC"                      \
                         USE_OPENMP=1                                                   \
                         CEXTRALIB=-lgomp
           build:   make PREFIX=${prefix} install

#
  package: qt
  version: 5.15.15
           pre_unpack:   if ( -d ${build_aux}/qt-${vers} ) rm -fR ${build_aux}/qt-${vers}
           post_unpack:  mv qt-everywhere-src-${vers} qt-${vers}
           post_unpack:  setenv ROOT_qt qt-${vers}
           patch:        qt5-01.patch
           options:      -prefix ${prefix}/qt5          \
                         -sysconfdir ${prefix}/etc/xdg  \
                         -confirm-license               \
                         -opensource                    \
                         -openssl-linked                \
                         -nomake examples               \
                         -qt-zlib                       \
                         -no-opengl                     \
                         -no-rpath                      \
                         -I${prefix}/include            \
                         -L${prefix}lib                 \
                          OPENSSL_LIBS="${prefix}/lib/libssl.so ${prefix}/lib/libcrypto.so"

           build:        sed -i 's/python /python3 /' qtdeclarative/qtdeclarative.pro
           build:        make -j ${num_proc}
           build:        make install
           build:        find ${prefix}/qt5 -name \*.prl -exec sed -i -e '/^QMAKE_PRL_BUILD_DIR/d' {} \;

#
  package: log2ant
  version: 0.8.3
           pre_unpack:  if ( -d ${build_aux}/log2ant-${vers} ) rm -fR ${build_aux}/log2ant-${vers}
           options:     --prefix=${prefix}          \
                        --with-qt-dir=${prefix}/qt5
           build:       make 
           build:       make install


#
  package: cfitsio      
  version: 4.4.0
           patch:       cfitsio-01.patch
           pre_config:  setenv CC ${gcc} ; setenv FC ${gfortran}; setenv CFORTRANFLAGS "-nus"; setenv CFLAGS "-DNoUnderscoreAppend"
           options:     --prefix=${prefix}     \
                        --libdir=${prefix}/lib \
                        --enable-reentrant     \
                        --disable-curl         \
                        CC=${gcc}              \
                        FC=${gfortran}         \
                        CFLAGS="-m64 -DNoUnderscoreAppend -DINTEL_COMPILER"
           build:       if ( `uname` == "Darwin" ) \
                              sed -i -e "s|@rpath|${prefix}/lib|g" Makefile
           build:       make clean
           build:       make -j ${num_proc}
           build:       make install

#
# --- SGDASS maintained packages
#
[Packages]
  package: petools      
  version: 20241115
           options:     --prefix=${prefix}                       \
                        --with-blas="-L${prefix}/lib -lopenblas" \
                        --bits=64                                \
                        --with-zlib=${prefix}                    \
                        --with-png=${prefix}                     \
                        --with-readline=${prefix}                \
                        --with-ncurses=${prefix}                 \
                        --with-pgplot_tarball=${tarball}/pgplot5.2.tar.gz \
                        CC=${gcc}                                \
                        FC=${gfortran}
           build:       if ( -f Makefile ) make clean
           build:       make
	   build:       if ( `ps -eaf | grep ${prefix}/bin/pgxwin_server | grep -v grep` != "" ) killall -9 pgxwin_server
           build:       make install

#
  package: ners         
  version: 20210824
           options:     --prefix=${prefix}           \
                        --with-petools=${prefix}     \
                        --python-dir=${prefix}/script
           build:       if ( -f Makefile ) make clean
           build:       make 
           build:       make install

#
  package: spd_client   
  version: 20241125
           post_unpack: if ( -f ${tarball}/spd_client_example-${vers}.tar.bz2 ) tar -jxf ${tarball}/spd_client_example-${vers}.tar.bz2
           options:     --prefix=${prefix}       \
                        --with-petools=${prefix} \
                        CC=${gcc}                \
                        FC=${gfortran}
           build:       if ( -f Makefile ) make clean
           build:       make
           build:       make install

#
  package: vtd          
  version: 20241125
           options:     --prefix=${prefix}          \
                        --with-petools=${prefix}    \
                        --with-spd_client=${prefix} \
                        --with-cfitsio=${prefix}    \
                        --with-ners=${prefix}       \
                        --with-curl=${prefix}       \
                        --data=/vlbi/vtd_data
           build:       if ( -f Makefile ) make clean
           build:       make
           build:       make install

#
  package: tle
  version: 20230331
           options:     --prefix=${prefix}          \
                        --with-petools=${prefix}    \
                        --with-ners=${prefix}       \
                        --with-spd_client=${prefix} \
                        --with-vtd=${prefix}        \
                        --with-cfitsio=${prefix}   
           build:       if ( -f Makefile ) make clean
           build:       make
           build:       make install

#
  package: gvh          
  version: 20231222
           options:     --prefix=${prefix}          \
                        --with-petools=${prefix}    \
                        --with-vtd=${prefix}        \
                        --with-ners=${prefix}
           build:       if ( -f Makefile ) make clean
           build:       make
           build:       make install

#
  package: fourpack     
  version: 20220220
           options:     --prefix=${prefix}          \
                        --with-petools=${prefix}    \
                        --with-fftw=${prefix}       \
                        --without-mkl
           build:       if ( -f Makefile ) make clean
           build:       make
           build:       make install

#
  package: vex_parser   
  version: 20210707
           options:     --prefix=${prefix}          \
                        --with-petools=${prefix}
           build:       if ( -f Makefile ) make clean
           build:       make
           build:       make install

#
  package: atp
  version: 20240507
           options:     --prefix=${prefix}          \
                        --with-petools=${prefix}    \
                        --with-ners=${prefix}       
           build:       if ( -f Makefile ) make clean
           build:       make
           build:       make install

#
  package: psolve       
  version: 20241125
           options:     --prefix=${prefix}                  \
                        --with-petools=${prefix}            \
                        --with-cfitsio=${prefix}            \
                        --with-spd_client=${prefix}         \
                        --with-ners=${prefix}               \
                        --with-vtd=${prefix}                \
                        --with-gvh=${prefix}                \
                        --with-vex_parser=${prefix}         \
                        --scratch_data=/scr/psolve          \
                        --save_data=${prefix}/share/psolve  \
                        --gvf_data=/l2/gvf                  \
                        --center_abr=${center_abr}          \
                        --center_name=${center_name}        \
                        --ps_viewer=/usr/bin/display        \
                        --gif_viewer=/usr/bin/display       \
                        --scratch_pima=/scr/pima            \
                        --stp_dir=/cont/stp 
           build:       if ( -f Makefile ) make clean
           build:       make
           build:       make install

#
  package: pima         
  version: 20250107
           post_unpack: if ( ! -d ${prefix}/share/pima ) mkdir -m 775 ${prefix}/share/pima 
           options:     --prefix=${prefix}                    \
                        --with-petools=${prefix}              \
                        --with-vtd=${prefix}                  \
                        --with-spd_client=${prefix}           \
                        --with-gvh=${prefix}                  \
                        --with-fourpack=${prefix}             \
                        --with-cfitsio=${prefix}              \
                        --with-solve=${prefix}                \
                        --with-ners=${prefix}                 \
                        --with-difmap=${prefix}               \
                        --pima-fits=/tmp                      \
                        --pima-exp-dir=/vlbi                  \
                        --pima-scratch=/scr/pima              \
                        --stable-share=${prefix}/share/pima
           build:       if ( -f Makefile ) make clean
           build:       make
           build:       make install

#
  package: sur_sked
  version: 20240430
           options:     --prefix=${prefix}                    \
                        --with-petools=${prefix}              \
                        --with-vtd=${prefix}                  \
                        --with-cfitsio=${prefix}              \
                        --with-ners=${prefix} 
           build:       if ( -f Makefile ) make clean
           build:       make
           build:       make install

#
  package: vsdc
  version: 20240204
           options:     noconfigure
           build:       if ( -d __pycache__  ) rm -fR __pycache__
           build:       if ( ! -d /cont/vsdc ) mkdir 775 /cont/vsdc
           build:       ./vsdc_install.py  --prefix=${prefix} --config_dir=/cont --datacenter=CDDIS

#
  package: malo
  version: 20241125
           post_unpack: if ( -f ${tarball}/malo_share-${vers}.tar.bz2 ) tar -jxf ${tarball}/malo_share-${vers}.tar.bz2
           options:     --prefix=${prefix}              \
                        --with-petools=${prefix}        \
                        --with-cfitsio=${prefix}        \
                        --with-ners=${prefix}           \
                        --with-vtd=${prefix}            \
                        --with-fourpack=${prefix}       \
                        --with-spd_client=${prefix}     \
                        --with-netcdf=${prefix}         \
                        --with-hdf5=${prefix}           \
                        --with-hdf4=${prefix}           \
                        --with-w3=${prefix}             \
                        --with-fftw=${prefix}           \
                        --share=${prefix}/malo/share    \
                        --script=${prefix}/malo/script  \
                        --model=/imls/oper_model        \
                        --dev_model=/imls/devel_model

           build:       if ( -f Makefile ) make clean
           build:       make static
           build:       make shared
           build:       make install
           build:       make install_data

#
  package: spd
  version: 20241125
           post_unpack: if ( -f ${tarball}/spd_share-${vers}.tar.bz2 ) tar -jxf ${tarball}/spd_share-${vers}.tar.bz2
           options:     --prefix=${prefix}        \
                        --with-petools=${prefix}  \
                        --with-malo=${prefix}     \
                        --with-netcdf=${prefix}   \
                        --with-hdf4=${prefix}     \
                        --with-hdf5=${prefix}     \
                        --with-fourpack=${prefix} \
                        --with-vtd=${prefix}      \
                        --with-cfitsio=${prefix}  \
                        --with-ners=${prefix}
           build:       if ( -f Makefile ) make clean
           build:       make 
           build:       make install

#
[AuxPackages]
  package: difmap
  version: 2.5o
           build_aux_dir: yes
           pre_unpack:    if ( -d ${build_aux}/difmap-${vers} ) rm -fR ${build_aux}/difmap-${vers}
           pre_unpack:    if ( -d ${build_aux}/difmap_${vers} ) rm -fR ${build_aux}/difmap_${vers}
           post_unpack:   setenv ROOT_difmap ${build_aux}/difmap-${vers}
	   post_unpack:   mv uvf_difmap_${vers} difmap-${vers}
           patch:         difmap-01.patch
           patch:         difmap-02.patch
	   pre_config:    grep   "PETOOLS_PREFIX\|SOLVE_LIB_X11" ${prefix}/bin/petools_vars > x11_lib.csh
	   pre_config:    source x11_lib.csh
	   pre_config:    rm     x11_lib.csh
           options:       linux-ia64-gcc 
           build:         find ./ -name "*.o" -exec rm {} \;
           build:         ./makeall
           build:         cp difmap  ${prefix}/bin/difmap     
#
           build:         cat /progs/sgdass/CHANGES | head -1 | awk '{print $1}' | sed -e 's@\.@@g' > ${prefix}/share/sgdass_version.txt

#

[PostInstall]:

psolve:   psolve_reset AU 24000 24000

vtd:      ${prefix}/bin/vtd_apriori_update.py -c /vlbi/vtd_data/apr_update.conf -d -v 2

pima:     ${prefix}/bin/pima_fftw_plan_create.csh big all

malo:     ${prefix}/bin/malo_fftw_plan_create.csh
